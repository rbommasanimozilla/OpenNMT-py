#!/bin/bash
source ../tmp/venv/bin/activate
mkdir keep
python preprocess.py -train_src /snakepit/shared/data/cornell/newsroom/train.txt.srcp -train_tgt /snakepit/shared/data/cornell/newsroom/train.txt.tgtp -valid_src /snakepit/shared/data/cornell/newsroom/val.txt.srcp -valid_tgt /snakepit/shared/data/cornell/newsroom/val.txt.tgtp -save_data keep/newsroom -src_seq_length 10000 -tgt_seq_length 10000 -src_seq_length_trunc 400 -tgt_seq_length_trunc 100 -dynamic_dict -share_vocab -max_shard_size 10485760
python -u train.py -data keep/newsroom -save_model models/newsroom -layers 4 -rnn_size 512 -word_vec_size 512 -max_grad_norm 0 -optim adam -encoder_type transformer -decoder_type transformer -position_encoding -dropout 0\.2 -param_init 0 -warmup_steps 8000 -learning_rate 2 -decay_method noam -label_smoothing 0.1 -adam_beta2 0.998 -batch_size 4096 -batch_type tokens -normalization tokens -max_generator_batches 2 -train_steps 400000 -start_checkpoint_at 8 -accum_count 4 -share_embeddings -copy_attn -param_init_glorot -gpuid 0
mkdir testout
python translate.py -gpu 0 -batch_size 32 -beam_size 10 -model models/newsroom_step_250000.pt -src /snakepit/shared/data/cornell/newsroom/val.txt.srcp -output testout/newsroom_step_250000.out -min_length 5 -stepwise_penalty -coverage_penalty summary -beta 5 -length_penalty wu -alpha 0.9 -block_ngram_repeat 3
python translate.py -gpu 0 -batch_size 32 -beam_size 10 -model models/newsroom_step_400000.pt -src /snakepit/shared/data/cornell/newsroom/val.txt.srcp -output testout/newsroom_step_400000.out -min_length 5 -stepwise_penalty -coverage_penalty summary -beta 5 -length_penalty wu -alpha 0.9 -block_ngram_repeat 3