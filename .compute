#!/bin/bash
source ../tmp/venv/bin/activate
python preprocess.py -train_src /snakepit/shared/data/cornell/newsroom/newsroom-lg/train.txt.tgtp -train_tgt /snakepit/shared/data/cornell/newsroom/newsroom-lg/train.txt.tgtp -valid_src /snakepit/shared/data/cornell/newsroom/newsroom-lg/val.txt.tgtp -valid_tgt /snakepit/shared/data/cornell/newsroom/newsroom-lg/val.txt.tgtp -save_data /snakepit/shared/data/cornell/newsroom-copy -src_seq_length 10000 -tgt_seq_length 10000 -src_seq_length_trunc 400 -tgt_seq_length_trunc 100 -dynamic_dict -share_vocab -max_shard_size 10485760
python train.py -gpuid 0 -save_model /snakepit/shared/data/cornell/copytest -data /snakepit/shared/data/cornell/newsroom-copy -copy_attn -global_attention mlp -word_vec_size 2048 -rnn_size 512 -layers 2 -encoder_type brnn -train_steps 30000 -max_grad_norm 2 -dropout 0. -batch_size 16 -optim adagrad -learning_rate 0.15 -adagrad_accumulator_init 0.1 -reuse_copy_attn -copy_loss_by_seqlength -bridge -seed 777
mkdir testout
python translate.py -gpu 0 -fast -batch_size 32 -beam_size 5 -model /snakepit/shared/data/cornell/copytest_step_25000.pt -src /snakepit/shared/data/cornell/newsroom/newsroom-lg/val.txt.srcp -output testout/copytest1_step_25000.out -min_length 10 -verbose -stepwise_penalty -coverage_penalty summary -beta 5 -length_penalty wu -alpha 0.9 -verbose -block_ngram_repeat 3 -ignore_when_blocking "." "</t>" "<t>"
python translate.py -gpu 0 -batch_size 32 -beam_size 5 -model /snakepit/shared/data/cornell/copytest_step_25000.pt -src /snakepit/shared/data/cornell/newsroom/newsroom-lg/val.txt.srcp -output testout/copytest2_step_25000.out -min_length 10 -verbose -stepwise_penalty -coverage_penalty summary -beta 5 -length_penalty wu -alpha 0.9 -verbose -block_ngram_repeat 3 -ignore_when_blocking "." "</t>" "<t>"
python translate.py -gpu 0 -batch_size 8 -beam_size 5 -model /snakepit/shared/data/cornell/copytest_step_25000.pt -src /snakepit/shared/data/cornell/newsroom/newsroom-lg/val.txt.tgtp -output testout/copytest3_step_25000.out -min_length 10 -verbose -stepwise_penalty -coverage_penalty summary -beta 5 -length_penalty wu -alpha 0.9 -verbose -block_ngram_repeat 3 -ignore_when_blocking "." "</t>" "<t>"
python translate.py -gpu 0 -batch_size 1 -beam_size 5 -model /snakepit/shared/data/cornell/copytest_step_25000.pt -src /snakepit/shared/data/cornell/newsroom/newsroom-lg/val.txt.tgtp -output testout/copytest4_step_25000.out -min_length 10 -verbose -stepwise_penalty -coverage_penalty summary -beta 5 -length_penalty wu -alpha 0.9 -verbose -block_ngram_repeat 3 -ignore_when_blocking "." "</t>" "<t>"